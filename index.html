<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DGS Consulting ROI Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; color: #228B22; }
    .tab { display: flex; justify-content: center; margin-bottom: 20px; }
    .tab button { padding: 10px 20px; border: none; cursor: pointer; background: #ddd; margin: 0 5px; border-radius: 5px; }
    .tab button.active { background: #228B22; color: white; }
    .tabcontent { display: none; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .results { margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px; }
    .btn { background: #228B22; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #1a6b1a; }
  </style>
  <script>
    const DGS_LOGO_PATH = "assets/logo.png"; // <-- Update this path to your logo in repo

    function openTab(evt, tabName) {
      const tabcontent = document.getElementsByClassName("tabcontent");
      for (let i = 0; i < tabcontent.length; i++) tabcontent[i].style.display = "none";
      const tablinks = document.getElementsByClassName("tablink");
      for (let i = 0; i < tablinks.length; i++) tablinks[i].classList.remove("active");
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.classList.add("active");
    }

    // === Investment Calculator ===
    function calcInvestment() {
      const invest = parseFloat(document.getElementById("investment").value);
      const gain = parseFloat(document.getElementById("return").value);
      const roi = ((gain - invest) / invest * 100).toFixed(2);
      document.getElementById("investmentResults").innerText =
        `Investment: $${invest}\nReturn: $${gain}\nROI: ${roi}%`;
    }

    // === Marketing Calculator ===
    function calcMarketing() {
      const cost = parseFloat(document.getElementById("marketingCost").value);
      const rev = parseFloat(document.getElementById("marketingRevenue").value);
      const roi = ((rev - cost) / cost * 100).toFixed(2);
      document.getElementById("marketingResults").innerText =
        `Cost: $${cost}\nRevenue: $${rev}\nROI: ${roi}%`;
    }

    // === Break-even Calculator ===
    function calcBreakEven() {
      const fixed = parseFloat(document.getElementById("fixedCost").value);
      const price = parseFloat(document.getElementById("price").value);
      const variable = parseFloat(document.getElementById("variableCost").value);
      const units = (fixed / (price - variable)).toFixed(2);
      document.getElementById("breakEvenResults").innerText =
        `Fixed Cost: $${fixed}\nPrice: $${price}\nVariable Cost: $${variable}\nBreak-even Units: ${units}`;
    }

    // === Scenario Planning ===
    let pieChart, barChart;
    function calcScenario() {
      const best = parseFloat(document.getElementById("bestCase").value);
      const worst = parseFloat(document.getElementById("worstCase").value);
      const expected = parseFloat(document.getElementById("expectedCase").value);
      document.getElementById("scenarioResults").innerText =
        `Best Case: $${best}\nExpected Case: $${expected}\nWorst Case: $${worst}`;

      const pieCtx = document.getElementById("scenarioPieChartCanvas").getContext("2d");
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(pieCtx, {
        type: "pie",
        data: { labels: ["Best", "Expected", "Worst"], datasets: [{ data: [best, expected, worst], backgroundColor: ["#228B22", "#666", "#ccc"] }] }
      });

      const barCtx = document.getElementById("scenarioBarChartCanvas").getContext("2d");
      if (barChart) barChart.destroy();
      barChart = new Chart(barCtx, {
        type: "bar",
        data: { labels: ["Best", "Expected", "Worst"], datasets: [{ data: [best, expected, worst], backgroundColor: ["#228B22", "#666", "#ccc"] }] }
      });
    }

    // === Global Export Full Report (Branded) ===
    async function exportFullReportPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("p", "mm", "a4");

      const logo = new Image();
      logo.src = DGS_LOGO_PATH;

      logo.onload = () => {
        let pageNumber = 1;
        function addHeaderFooter() {
          pdf.addImage(logo, "PNG", 10, 5, 30, 15);
          pdf.setFontSize(14);
          pdf.setTextColor(0, 100, 0);
          pdf.text("DGS Consulting", 105, 15, { align: "center" });
          pdf.setDrawColor(200);
          pdf.line(10, 285, 200, 285);
          pdf.setFontSize(10);
          pdf.setTextColor(100);
          pdf.text("www.dgsconsulting.com", 10, 292);
          pdf.text("Page " + pageNumber, 200, 292, { align: "right" });
          pageNumber++;
        }

        // === Title Page ===
        addHeaderFooter();
        pdf.setFontSize(20); pdf.setTextColor(0);
        pdf.text("ROI Calculator Report", 105, 100, { align: "center" });
        pdf.setFontSize(12); pdf.setTextColor(80);
        pdf.text("Generated on: " + new Date().toLocaleString(), 105, 120, { align: "center" });
        pdf.addPage();

        // Helper for sections
        function addSection(title, elementId, color = [34, 139, 34]) {
          addHeaderFooter();
          pdf.setFontSize(16); pdf.setTextColor(...color);
          pdf.text(title, 10, 30);
          pdf.setFontSize(12); pdf.setTextColor(0);
          const el = document.getElementById(elementId);
          if (el && el.innerText.trim() !== "") {
            const text = pdf.splitTextToSize(el.innerText, 180);
            pdf.text(text, 10, 40);
          } else {
            pdf.text("No results calculated yet.", 10, 40);
          }
          pdf.addPage();
        }

        addSection("Investment Calculator", "investmentResults");
        addSection("Marketing Calculator", "marketingResults");
        addSection("Break-even Calculator", "breakEvenResults");
        addSection("Scenario Planning", "scenarioResults");

        const pieCanvas = document.getElementById("scenarioPieChartCanvas");
        const barCanvas = document.getElementById("scenarioBarChartCanvas");

        if (pieCanvas && barCanvas) {
          addHeaderFooter();
          pdf.setFontSize(16); pdf.setTextColor(34, 139, 34);
          pdf.text("Scenario Charts", 10, 30);

          const pieImg = pieCanvas.toDataURL("image/png");
          const barImg = barCanvas.toDataURL("image/png");

          pdf.addImage(pieImg, "PNG", 10, 40, 80, 80);
          pdf.addImage(barImg, "PNG", 110, 40, 80, 80);
        }

        pdf.save("Full_ROI_Report.pdf");
      };
    }
  </script>
</head>
<body>
  <h1>DGS Consulting ROI Calculator</h1>

  <div class="tab">
    <button class="tablink active" onclick="openTab(event,'Investment')">Investment</button>
    <button class="tablink" onclick="openTab(event,'Marketing')">Marketing</button>
    <button class="tablink" onclick="openTab(event,'BreakEven')">Break-even</button>
    <button class="tablink" onclick="openTab(event,'Scenario')">Scenario</button>
  </div>

  <!-- Investment -->
  <div id="Investment" class="tabcontent" style="display:block;">
    <h2>Investment Calculator</h2>
    <input type="number" id="investment" placeholder="Investment ($)">
    <input type="number" id="return" placeholder="Return ($)">
    <button class="btn" onclick="calcInvestment()">Calculate</button>
    <div id="investmentResults" class="results"></div>
  </div>

  <!-- Marketing -->
  <div id="Marketing" class="tabcontent">
    <h2>Marketing ROI</h2>
    <input type="number" id="marketingCost" placeholder="Cost ($)">
    <input type="number" id="marketingRevenue" placeholder="Revenue ($)">
    <button class="btn" onclick="calcMarketing()">Calculate</button>
    <div id="marketingResults" class="results"></div>
  </div>

  <!-- Break Even -->
  <div id="BreakEven" class="tabcontent">
    <h2>Break-even Calculator</h2>
    <input type="number" id="fixedCost" placeholder="Fixed Cost ($)">
    <input type="number" id="price" placeholder="Price per Unit ($)">
    <input type="number" id="variableCost" placeholder="Variable Cost per Unit ($)">
    <button class="btn" onclick="calcBreakEven()">Calculate</button>
    <div id="breakEvenResults" class="results"></div>
  </div>

  <!-- Scenario Planning -->
  <div id="Scenario" class="tabcontent">
    <h2>Scenario Planning</h2>
    <input type="number" id="bestCase" placeholder="Best Case ($)">
    <input type="number" id="expectedCase" placeholder="Expected Case ($)">
    <input type="number" id="worstCase" placeholder="Worst Case ($)">
    <button class="btn" onclick="calcScenario()">Calculate</button>
    <div id="scenarioResults" class="results"></div>
    <canvas id="scenarioPieChartCanvas" width="300" height="300"></canvas>
    <canvas id="scenarioBarChartCanvas" width="300" height="300"></canvas>
  </div>

  <!-- Global Export -->
  <div class="flex justify-center mt-8" style="text-align:center; margin-top:20px;">
    <button class="btn" onclick="exportFullReportPDF()">Download Full ROI Report (PDF)</button>
  </div>
</body>
</html>
