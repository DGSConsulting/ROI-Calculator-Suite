<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ROI Calculator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #f0f9f7; color: #064e3b; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { text-align: center; color: #065f46; margin-bottom: 20px; }
    button { background: #16a34a; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 13px; margin: 5px; }
    button:hover { background: #15803d; }
    .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
    label { display: block; font-weight: bold; margin-top: 8px; font-size: 12px; }
    input { width: 100%; padding: 6px; margin: 4px 0; border: 1px solid #ccc; border-radius: 4px; }
    canvas { margin-top: 10px; }
    .result { background: #f0fff6; padding: 10px; border-radius: 4px; margin-top: 10px; font-weight: bold; color: #065f46; }
    .scenario { background: #f0fff6; padding: 10px; margin: 8px 0; border-left: 4px solid #16a34a; }
    .sensitivity { font-size: 11px; color: #0b6b45; margin-top: 6px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ROI Calculator Suite</h1>
    
    <div class="card">
      <button onclick="loadTemplate()">Load Example</button>
      <button onclick="compareROI()">Compare Results</button>
      <button onclick="shareState()">Share Link</button>
      <button onclick="clearAllData()">Clear All</button>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Process Optimization</h3>
        <label>Hours per week (Low/Best/High)</label>
        <input type="number" id="proc_low" placeholder="3" />
        <input type="number" id="proc_best" placeholder="5" />
        <input type="number" id="proc_high" placeholder="7" />
        <label>Hourly rate ($)</label>
        <input type="number" id="proc_rate" placeholder="35" />
        <label>Implementation cost ($)</label>
        <input type="number" id="proc_cost" placeholder="2500" />
        <label>Years to project</label>
        <input type="number" id="proc_years" value="3" />
        <button onclick="calcProcess()">Calculate</button>
        <button onclick="openWhatIf('proc')">What-If</button>
        <button onclick="saveResult('Process', 'proc_result')">Save</button>
        <div class="result" id="proc_result">—</div>
        <div class="sensitivity" id="proc_sens">—</div>
        <canvas id="proc_chart"></canvas>
      </div>

      <div class="card">
        <h3>Software ROI</h3>
        <label>Current annual cost ($)</label>
        <input type="number" id="soft_current" placeholder="12000" />
        <label>Efficiency gain (%)</label>
        <input type="number" id="soft_gain" placeholder="20" />
        <label>New cost ($)</label>
        <input type="number" id="soft_new" placeholder="4500" />
        <label>Years to project</label>
        <input type="number" id="soft_years" value="3" />
        <button onclick="calcSoftware()">Calculate</button>
        <button onclick="openWhatIf('soft')">What-If</button>
        <button onclick="saveResult('Software', 'soft_result')">Save</button>
        <div class="result" id="soft_result">—</div>
        <div class="sensitivity" id="soft_sens">—</div>
        <canvas id="soft_chart"></canvas>
      </div>

      <div class="card">
        <h3>Training ROI</h3>
        <label>Employees trained</label>
        <input type="number" id="train_count" placeholder="3" />
        <label>Revenue per employee ($)</label>
        <input type="number" id="train_rev" placeholder="75000" />
        <label>Productivity gain (%)</label>
        <input type="number" id="train_gain" placeholder="8" />
        <label>Training cost ($)</label>
        <input type="number" id="train_cost" placeholder="3500" />
        <button onclick="calcTraining()">Calculate</button>
        <button onclick="saveResult('Training', 'train_result')">Save</button>
        <div class="result" id="train_result">—</div>
        <canvas id="train_chart"></canvas>
      </div>

      <div class="card">
        <h3>Payback Period</h3>
        <label>Initial investment ($)</label>
        <input type="number" id="payback_init" placeholder="25000" />
        <label>Annual cash flow ($)</label>
        <input type="number" id="payback_annual" placeholder="8000" />
        <button onclick="calcPayback()">Calculate</button>
        <button onclick="saveResult('Payback', 'payback_result')">Save</button>
        <div class="result" id="payback_result">—</div>
        <canvas id="payback_chart"></canvas>
      </div>

      <div class="card">
        <h3>Break-Even Analysis</h3>
        <label>Fixed costs ($)</label>
        <input type="number" id="bre_fixed" placeholder="15000" />
        <label>Price per unit ($)</label>
        <input type="number" id="bre_price" placeholder="100" />
        <label>Variable cost per unit ($)</label>
        <input type="number" id="bre_var" placeholder="40" />
        <label>Monthly units target</label>
        <input type="number" id="bre_monthly" placeholder="200" />
        <button onclick="calcBreakeven()">Calculate</button>
        <button onclick="saveResult('Break-Even', 'bre_result')">Save</button>
        <div class="result" id="bre_result">—</div>
        <canvas id="bre_chart"></canvas>
      </div>

      <div class="card">
        <h3>NPV & IRR</h3>
        <label>Initial investment ($)</label>
        <input type="number" id="npv_init" placeholder="50000" />
        <label>Annual cash flows (comma-separated)</label>
        <input type="text" id="npv_flows" placeholder="15000,18000,20000,22000" />
        <label>Discount rate (%)</label>
        <input type="number" id="npv_rate" placeholder="12" />
        <button onclick="calcNPV()">Calculate</button>
        <button onclick="saveResult('NPV', 'npv_result')">Save</button>
        <div class="result" id="npv_result">—</div>
        <canvas id="npv_chart"></canvas>
      </div>
    </div>

    <div class="card">
      <h3>Saved Scenarios</h3>
      <div id="scenariosList"></div>
      <button onclick="clearScenarios()">Clear Scenarios</button>
    </div>
  </div>

  <footer style="background: linear-gradient(180deg, #065f46, #043d2e); color: white; padding: 20px; margin-top: 40px; text-align: center; border-top: 3px solid #16a34a;">
    <p style="margin: 0; font-weight: bold; font-size: 16px; margin-bottom: 12px;">DGS Consulting</p>
    <p style="margin: 0;">
      <a href="https://dgsconsulting.solutions/" target="_blank" style="background: #16a34a; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; display: inline-block; margin: 5px; font-size: 13px; font-weight: 600;">Visit Website</a>
      <a href="https://www.linkedin.com/in/dg-snook/" target="_blank" style="background: #16a34a; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; display: inline-block; margin: 5px; font-size: 13px; font-weight: 600;">LinkedIn</a>
      <a href="mailto:DGSConsult@consultant.com" style="background: #16a34a; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; display: inline-block; margin: 5px; font-size: 13px; font-weight: 600;">Contact</a>
    </p>
  </footer>

  <div id="whatIfModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center;">
    <div style="background:white;padding:20px;border-radius:8px;max-width:500px;width:90%;">
      <span onclick="closeWhatIf()" style="float:right;cursor:pointer;font-size:24px;font-weight:bold;">x</span>
      <h3>What-If Analysis</h3>
      <p id="whatIfLabel">—</p>
      <label>Adjust to: <span id="whatIfPercent">100</span>%</label>
      <input type="range" id="whatIfSlider" min="10" max="200" value="100" onchange="updateWhatIf()" style="width:100%;cursor:pointer;margin:10px 0;" />
      <div style="background:#f0fff6;padding:10px;border-radius:4px;margin:10px 0;font-size:12px;">
        <strong>Result:</strong> <span id="whatIfResult">—</span>
      </div>
      <button onclick="closeWhatIf()">Close</button>
    </div>
  </div>
</body>
</html>

<script>
var scenarios = [];
var results = {};
var charts = {};
var whatIfCalcType = null;

function initChart(id, label) {
  var c = document.getElementById(id);
  if (!c) return;
  charts[id] = new Chart(c.getContext('2d'), {
    type: 'line',
    data: { labels: [], datasets: [{ label: label, data: [], borderColor: '#16a34a', backgroundColor: 'rgba(22,163,74,0.1)', tension: 0.3 }] },
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });
}

function fmt(n) {
  return '$' + Math.round(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function calcProcess() {
  var low = parseFloat(document.getElementById('proc_low').value) || 0;
  var best = parseFloat(document.getElementById('proc_best').value) || 0;
  var high = parseFloat(document.getElementById('proc_high').value) || 0;
  var rate = parseFloat(document.getElementById('proc_rate').value) || 0;
  var cost = parseFloat(document.getElementById('proc_cost').value) || 0;
  var years = parseFloat(document.getElementById('proc_years').value) || 3;
  var savingsBest = best * rate * 52 * years;
  var roi = cost === 0 ? 0 : ((savingsBest - cost) / cost) * 100;
  var roiLow = cost === 0 ? 0 : ((low * rate * 52 * years - cost) / cost) * 100;
  var roiHigh = cost === 0 ? 0 : ((high * rate * 52 * years - cost) / cost) * 100;
  document.getElementById('proc_result').innerHTML = 'Savings: ' + fmt(savingsBest) + ' | ROI: ' + roi.toFixed(1) + '%';
  document.getElementById('proc_sens').innerHTML = 'Range: ' + roiLow.toFixed(1) + '% to ' + roiHigh.toFixed(1) + '%';
  results.process = roi;
}

function calcSoftware() {
  var current = parseFloat(document.getElementById('soft_current').value) || 0;
  var gain = parseFloat(document.getElementById('soft_gain').value) || 0;
  var newCost = parseFloat(document.getElementById('soft_new').value) || 0;
  var years = parseFloat(document.getElementById('soft_years').value) || 3;
  var benefit = current * (gain / 100) * years;
  var totalCost = newCost * years;
  var roi = totalCost === 0 ? 0 : ((benefit - totalCost) / totalCost) * 100;
  document.getElementById('soft_result').innerHTML = 'Benefit: ' + fmt(benefit) + ' | ROI: ' + roi.toFixed(1) + '%';
  document.getElementById('soft_sens').innerHTML = 'Annual: ' + gain + '% = ' + fmt(current * (gain / 100));
  results.software = roi;
}

function calcTraining() {
  var count = parseFloat(document.getElementById('train_count').value) || 0;
  var rev = parseFloat(document.getElementById('train_rev').value) || 0;
  var gain = parseFloat(document.getElementById('train_gain').value) || 0;
  var cost = parseFloat(document.getElementById('train_cost').value) || 0;
  var benefit = count * rev * (gain / 100);
  var roi = cost === 0 ? 0 : ((benefit - cost) / cost) * 100;
  document.getElementById('train_result').innerHTML = 'Benefit: ' + fmt(benefit) + ' | ROI: ' + roi.toFixed(1) + '%';
  results.training = roi;
}

function calcPayback() {
  var init = parseFloat(document.getElementById('payback_init').value) || 0;
  var annual = parseFloat(document.getElementById('payback_annual').value) || 0;
  var years = annual === 0 ? 999 : init / annual;
  document.getElementById('payback_result').innerHTML = 'Payback: ' + years.toFixed(2) + ' years';
  results.payback = years;
}

function calcBreakeven() {
  var fixed = parseFloat(document.getElementById('bre_fixed').value) || 0;
  var price = parseFloat(document.getElementById('bre_price').value) || 0;
  var variable = parseFloat(document.getElementById('bre_var').value) || 0;
  if (price <= variable) {
    document.getElementById('bre_result').innerHTML = 'Error: Price > Variable cost';
    return;
  }
  var units = Math.ceil(fixed / (price - variable));
  document.getElementById('bre_result').innerHTML = 'Break-even: ' + units + ' units';
  results.breakeven = units;
}

function calcNPV() {
  var init = parseFloat(document.getElementById('npv_init').value) || 0;
  var flows = (document.getElementById('npv_flows').value || '').split(',').map(function(x) { return parseFloat(x.trim()); }).filter(function(x) { return !isNaN(x); });
  var rate = (parseFloat(document.getElementById('npv_rate').value) || 0) / 100;
  var npv = -init;
  for (var i = 0; i < flows.length; i++) {
    npv += flows[i] / Math.pow(1 + rate, i + 1);
  }
  document.getElementById('npv_result').innerHTML = 'NPV: ' + fmt(npv);
  results.npv = npv;
}

function saveResult(name, id) {
  var note = prompt('Add a note:', '');
  scenarios.push({ name: name, value: document.getElementById(id).innerHTML, note: note || '' });
  renderScenarios();
}

function renderScenarios() {
  var html = '';
  for (var i = 0; i < scenarios.length; i++) {
    html += '<div class="scenario"><strong>' + scenarios[i].name + '</strong><br/>' + scenarios[i].value + '<br/><em style="font-size:11px">Note: ' + scenarios[i].note + '</em><br/><button onclick="delScenario(' + i + ')" style="padding:4px 8px;font-size:11px">Delete</button></div>';
  }
  document.getElementById('scenariosList').innerHTML = html || '<p>No scenarios</p>';
}

function delScenario(i) {
  scenarios.splice(i, 1);
  renderScenarios();
}

function clearScenarios() {
  if (confirm('Clear all?')) { scenarios = []; renderScenarios(); }
}

function clearAllData() {
  if (confirm('Clear everything?')) {
    scenarios = [];
    results = {};
    document.querySelectorAll('input').forEach(function(el) { el.value = ''; });
    document.querySelectorAll('.result').forEach(function(el) { el.innerHTML = '—'; });
    document.querySelectorAll('.sensitivity').forEach(function(el) { el.innerHTML = '—'; });
    renderScenarios();
  }
}

function loadTemplate() {
  document.getElementById('proc_low').value = 3;
  document.getElementById('proc_best').value = 5;
  document.getElementById('proc_high').value = 7;
  document.getElementById('proc_rate').value = 35;
  document.getElementById('proc_cost').value = 2500;
  document.getElementById('proc_years').value = 3;
  calcProcess();
  document.getElementById('soft_current').value = 12000;
  document.getElementById('soft_gain').value = 20;
  document.getElementById('soft_new').value = 4500;
  document.getElementById('soft_years').value = 3;
  calcSoftware();
  document.getElementById('train_count').value = 3;
  document.getElementById('train_rev').value = 75000;
  document.getElementById('train_gain').value = 8;
  document.getElementById('train_cost').value = 3500;
  calcTraining();
  document.getElementById('payback_init').value = 25000;
  document.getElementById('payback_annual').value = 8000;
  calcPayback();
  document.getElementById('bre_fixed').value = 15000;
  document.getElementById('bre_price').value = 100;
  document.getElementById('bre_var').value = 40;
  document.getElementById('bre_monthly').value = 200;
  calcBreakeven();
  document.getElementById('npv_init').value = 50000;
  document.getElementById('npv_flows').value = '15000,18000,20000,22000';
  document.getElementById('npv_rate').value = 12;
  calcNPV();
}

function compareROI() {
  var msg = 'Results:\n';
  if (results.process !== undefined) msg += 'Process: ' + results.process.toFixed(1) + '%\n';
  if (results.software !== undefined) msg += 'Software: ' + results.software.toFixed(1) + '%\n';
  if (results.training !== undefined) msg += 'Training: ' + results.training.toFixed(1) + '%\n';
  alert(msg || 'No results');
}

function openWhatIf(type) {
  whatIfCalcType = type;
  document.getElementById('whatIfLabel').innerHTML = type === 'proc' ? 'Process: Adjust hours' : 'Software: Adjust efficiency %';
  document.getElementById('whatIfSlider').value = 100;
  document.getElementById('whatIfModal').style.display = 'flex';
  updateWhatIf();
}

function updateWhatIf() {
  var pct = document.getElementById('whatIfSlider').value;
  document.getElementById('whatIfPercent').innerHTML = pct;
  if (whatIfCalcType === 'proc') {
    var adj = (parseFloat(document.getElementById('proc_best').value) || 0) * (pct / 100);
    var rate = parseFloat(document.getElementById('proc_rate').value) || 0;
    var cost = parseFloat(document.getElementById('proc_cost').value) || 0;
    var years = parseFloat(document.getElementById('proc_years').value) || 3;
    var savings = adj * rate * 52 * years;
    var roi = cost === 0 ? 0 : ((savings - cost) / cost) * 100;
    document.getElementById('whatIfResult').innerHTML = 'ROI: ' + roi.toFixed(1) + '% | Savings: ' + fmt(savings);
  } else {
    var adj = (parseFloat(document.getElementById('soft_gain').value) || 0) * (pct / 100);
    var current = parseFloat(document.getElementById('soft_current').value) || 0;
    var newCost = parseFloat(document.getElementById('soft_new').value) || 0;
    var years = parseFloat(document.getElementById('soft_years').value) || 3;
    var benefit = current * (adj / 100) * years;
    var totalCost = newCost * years;
    var roi = totalCost === 0 ? 0 : ((benefit - totalCost) / totalCost) * 100;
    document.getElementById('whatIfResult').innerHTML = 'ROI: ' + roi.toFixed(1) + '% | Benefit: ' + fmt(benefit);
  }
}

function closeWhatIf() {
  document.getElementById('whatIfModal').style.display = 'none';
}

function shareState() {
  var state = {
    proc_low: document.getElementById('proc_low').value,
    proc_best: document.getElementById('proc_best').value,
    proc_high: document.getElementById('proc_high').value,
    proc_rate: document.getElementById('proc_rate').value,
    proc_cost: document.getElementById('proc_cost').value,
    proc_years: document.getElementById('proc_years').value,
    soft_current: document.getElementById('soft_current').value,
    soft_gain: document.getElementById('soft_gain').value,
    soft_new: document.getElementById('soft_new').value,
    soft_years: document.getElementById('soft_years').value,
    train_count: document.getElementById('train_count').value,
    train_rev: document.getElementById('train_rev').value,
    train_gain: document.getElementById('train_gain').value,
    train_cost: document.getElementById('train_cost').value,
    payback_init: document.getElementById('payback_init').value,
    payback_annual: document.getElementById('payback_annual').value,
    bre_fixed: document.getElementById('bre_fixed').value,
    bre_price: document.getElementById('bre_price').value,
    bre_var: document.getElementById('bre_var').value,
    bre_monthly: document.getElementById('bre_monthly').value,
    npv_init: document.getElementById('npv_init').value,
    npv_flows: document.getElementById('npv_flows').value,
    npv_rate: document.getElementById('npv_rate').value
  };
  var encoded = btoa(JSON.stringify(state));
  var url = window.location.origin + window.location.pathname + '?state=' + encoded;
  alert('Share link:\n\n' + url);
  navigator.clipboard.writeText(url).catch(function() {});
}

window.addEventListener('load', function() {
  initChart('proc_chart', 'Process ROI %');
  initChart('soft_chart', 'Software ROI %');
  initChart('train_chart', 'Training ROI %');
  initChart('payback_chart', 'Years');
  initChart('bre_chart', 'Units');
  initChart('npv_chart', 'NPV');
  var params = new URLSearchParams(window.location.search);
  var encoded = params.get('state');
  if (encoded) {
    try {
      var state = JSON.parse(atob(encoded));
      Object.keys(state).forEach(function(key) {
        var el = document.getElementById(key);
        if (el) el.value = state[key];
      });
    } catch(e) {}
  }
});
</script>
