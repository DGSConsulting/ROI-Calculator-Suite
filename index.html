<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DGS ROI Calculator Suite</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  :root {
    --green: #3fa36b; --green-hover: #318d5a;
    --dark: #1e1e1e; --gray: #dcdcdc;
    --light: #f9f9f9; --text: #333;
    --border: #e0e0e0;
  }
  [data-theme="dark"] {
    --light: #121212; --text: #f1f1f1;
    --gray: #2a2a2a; --dark: #000; --border: #333;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: "Inter", sans-serif; background: var(--light); color: var(--text); transition: 0.3s; }
  .topbar { position: fixed; top:0; left:0; right:0; height:70px; background:var(--dark); display:flex; justify-content:space-between; align-items:center; padding:0 40px; z-index:1000; border-bottom:3px solid var(--green); }
  .logo { color: var(--green); font-weight:700; font-size:1.5rem; }
  .topbar-right { display:flex; align-items:center; gap:15px; }
  .btn { background:var(--green); color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:500; transition:0.2s; }
  .btn:hover { background:var(--green-hover); }
  .btn-secondary { background:#555; }
  .btn-secondary:hover { background:#444; }
  .container { max-width:1400px; margin:90px auto 40px; padding:0 40px; }
  .page-header { margin-bottom:40px; }
  .page-header h1 { font-size:2.2rem; margin-bottom:10px; font-weight:700; }
  .page-header p { color:#666; font-size:1.1rem; }
  [data-theme="dark"] .page-header p { color:#999; }
  .calculator-nav { display:flex; gap:10px; margin-bottom:30px; overflow-x:auto; padding-bottom:10px; }
  .calculator-nav button { background:white; color:var(--text); border:2px solid var(--border); padding:12px 24px; border-radius:8px; cursor:pointer; font-size:0.95rem; font-weight:500; white-space:nowrap; transition:all 0.2s; }
  [data-theme="dark"] .calculator-nav button { background:#2a2a2a; }
  .calculator-nav button:hover { border-color:var(--green); color:var(--green); }
  .calculator-nav button.active { background:var(--green); color:white; border-color:var(--green); }
  .calculator-content { display:none; }
  .calculator-content.active { display:grid; grid-template-columns:1fr 1fr; gap:30px; }
  .input-panel, .output-panel { background:white; padding:30px; border-radius:12px; border:1px solid var(--border); box-shadow:0 2px 8px rgba(0,0,0,0.05); }
  [data-theme="dark"] .input-panel, [data-theme="dark"] .output-panel { background:#1e1e1e; }
  .panel-header { font-size:1.3rem; font-weight:600; margin-bottom:25px; border-bottom:2px solid var(--border); padding-bottom:15px; }
  .form-group { margin-bottom:20px; }
  .form-group label { display:block; font-size:0.95rem; font-weight:500; margin-bottom:8px; }
  .form-group input { width:100%; padding:12px 15px; border:2px solid var(--border); border-radius:8px; background:var(--light); color:var(--text); font-size:1rem; }
  .form-group input:focus { outline:none; border-color:var(--green); }
  .btn-group { display:flex; gap:12px; margin-top:25px; }
  .btn-group .btn { flex:1; }
  .results { margin-top:20px; }
  .result-item { display:flex; justify-content:space-between; align-items:center; padding:15px; margin-bottom:10px; background:#f5f5f5; border-radius:8px; border-left:4px solid var(--green); }
  [data-theme="dark"] .result-item { background:#2a2a2a; }
  .result-label { font-weight:500; font-size:0.95rem; }
  .result-value { font-weight:700; font-size:1.1rem; color:var(--green); }
  .chart-container { margin-top:30px; padding:20px; background:#f9f9f9; border-radius:8px; border:1px solid var(--border); }
  [data-theme="dark"] .chart-container { background:#1a1a1a; }
  canvas { max-height:300px; }
  .pdf-section { margin-bottom:30px; }
  .scenarios-section { margin-top:40px; background:white; padding:30px; border-radius:12px; border:1px solid var(--border); box-shadow:0 2px 8px rgba(0,0,0,0.05); }
  [data-theme="dark"] .scenarios-section { background:#1e1e1e; }
  .scenario-item { background:var(--light); padding:20px; border-radius:8px; margin-top:15px; display:flex; justify-content:space-between; align-items:center; border:1px solid var(--border); }
  .scenario-info h4 { margin-bottom:5px; font-size:1.05rem; }
  .scenario-info p { margin:0; font-size:0.9rem; color:#666; }
  [data-theme="dark"] .scenario-info p { color:#999; }
  footer { text-align:center; padding:20px; background:var(--dark); color:white; margin-top:60px; border-top:3px solid var(--green); font-size:0.9rem; }
  footer a { color:var(--green); text-decoration:none; margin:0 10px; }
  .footer-button { margin-right:10px; }
  @media (max-width:1024px) { .calculator-content.active { grid-template-columns:1fr; } }
  @media print { .topbar, .calculator-nav, .btn { display:none !important; } .container { margin-top:20px; } }
</style>
</head>
<body data-theme="light">

<div class="topbar">
  <div class="logo">DGS CONSULTING</div>
  <div class="topbar-right">
    <button class="btn btn-secondary" onclick="toggleTheme()">Dark Mode</button>
    <button class="btn" onclick="exportPDF()">Export PDF</button>
  </div>
</div>

<div class="container">
  <div class="page-header">
    <h1>ROI Calculator Suite</h1>
    <p>Complete financial analysis and ROI calculations</p>
  </div>

  <div class="calculator-nav">
    <button class="active" onclick="showCalculator('process')">Process</button>
    <button onclick="showCalculator('software')">Software</button>
    <button onclick="showCalculator('training')">Training</button>
    <button onclick="showCalculator('payback')">Payback</button>
    <button onclick="showCalculator('breakeven')">Break-Even</button>
    <button onclick="showCalculator('npv')">NPV/IRR</button>
  </div>

  <!-- NPV / IRR Calculator (enhanced) -->
  <div id="npv" class="calculator-content">
    <div class="input-panel pdf-section">
      <h2 class="panel-header">NPV & IRR</h2>
      <div class="form-group"><label>Initial Investment ($)</label><input type="number" id="npv_invest" value="100000"></div>
      <div class="form-group"><label>Cash Flows (comma separated $)</label><input type="text" id="npv_cashflows" value="30000,40000,50000,60000"></div>
      <div class="form-group"><label>Discount Rate (%)</label><input type="number" id="npv_rate" value="10"></div>
      <div class="btn-group">
        <button class="btn" onclick="calcNPVIRR()">Calculate NPV / IRR</button>
        <button class="btn btn-secondary" onclick="resetForm('npv')">Reset</button>
      </div>
    </div>
    <div class="output-panel pdf-section">
      <h2 class="panel-header">Results</h2>
      <div id="npv_result" class="results"></div>
      <div class="chart-container pdf-section"><canvas id="npv_chart"></canvas></div>
    </div>
  </div>
</div>

<footer>
  <p style="margin:0">DGS Consulting<br>
  <a href="https://dgsconsulting.solutions/" target="_blank" class="footer-button">Visit Website</a> 
  <a href="https://www.linkedin.com/in/dg-snook/" target="_blank" class="footer-button">LinkedIn</a> 
  <a href="mailto:DGSConsult@consultant.com" class="footer-button">Contact</a></p>
</footer>

<script>
// --- Theme Toggle ---
function toggleTheme() { document.body.dataset.theme = document.body.dataset.theme==='dark'?'light':'dark'; }

// --- Calculator Navigation ---
function showCalculator(id){ document.querySelectorAll('.calculator-content').forEach(c=>c.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.calculator-nav button').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); }

// --- Reset Form ---
function resetForm(calc){ document.querySelectorAll(`#${calc} input`).forEach(inp=>inp.value=''); const res = document.getElementById(`${calc}_result`); if(res) res.innerHTML=''; if(calc==='npv'){ const ctx=document.getElementById('npv_chart').getContext('2d'); ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height); } }

// --- Enhanced NPV / IRR Calculation ---
function calcNPVIRR(){
  const invest=+document.getElementById('npv_invest').value;
  const cfArr=document.getElementById('npv_cashflows').value.split(',').map(Number);
  const rate=+document.getElementById('npv_rate').value/100;
  // NPV
  let npv=-invest; cfArr.forEach((c,i)=>npv+=c/Math.pow(1+rate,i+1));
  // IRR (approximation using iterative method)
  function irr(values, guess=0.1){
    let rate=guess, eps=0.00001, maxIter=1000;
    for(let i=0;i<maxIter;i++){
      let f=-values[0], fder=0;
      for(let j=1;j<values.length;j++){
        f+=values[j]/Math.pow(1+rate,j);
        fder+=-j*values[j]/Math.pow(1+rate,j+1);
      }
      let newRate=rate - f/fder;
      if(Math.abs(newRate-rate)<eps) return newRate;
      rate=newRate;
    }
    return rate;
  }
  const irrValue=irr([invest,...cfArr])*100;
  document.getElementById('npv_result').innerHTML=`<div class="result-item"><div class="result-label">NPV:</div><div class="result-value">$${npv.toFixed(2)}</div></div>
  <div class="result-item"><div class="result-label">IRR:</div><div class="result-value">${irrValue.toFixed(2)}%</div></div>`;
  // Chart
  const discounted=cfArr.map((c,i)=>c/Math.pow(1+rate,i+1));
  const ctx=document.getElementById('npv_chart').getContext('2d');
  new Chart(ctx,{type:'bar',data:{labels:cfArr.map((_,i)=>`Year ${i+1}`),datasets:[
    {label:'Cash Flow ($)', data:cfArr, backgroundColor:'rgba(63,163,107,0.7)'},
    {label:'Discounted CF ($)', data:discounted, backgroundColor:'rgba(63,163,107,0.3)'}
  ]}, options:{responsive:true, plugins:{legend:{position:'top'}}, scales:{y:{beginAtZero:true}}}});
}
</script>
</body>
</html>
