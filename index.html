<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DGS ROI Calculator - Refined</title>
  <style>
    :root {
      --primary: #6B8E5A;
      --accent: #9CAF88;
      --dark: #1f2937;
      --light: #f9fafb;
      --border: #d1d5db;
      --radius: 12px;
      --shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--light);
      color: var(--dark);
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h1 {
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    p.subtitle {
      color: #4b5563;
      margin-bottom: 2rem;
    }

    .calculator-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      max-width: 1000px;
      width: 100%;
    }

    .card {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    label {
      font-weight: 600;
      display: block;
      margin-top: 1rem;
      color: #374151;
    }

    input {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.3rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 0.95rem;
    }

    button {
      margin-top: 1.5rem;
      background: var(--primary);
      border: none;
      color: #fff;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    button:hover { background: #557343; }
    button.secondary { background: #e5e7eb; color: #374151; }
    button.secondary:hover { background: #d1d5db; }

    .result {
      margin-top: 1.5rem;
      font-size: 1rem;
      color: var(--dark);
    }

    .result-value {
      font-weight: 700;
      color: var(--primary);
    }

    canvas {
      width: 100% !important;
      height: 250px !important;
      margin-top: 1rem;
    }

    @media (max-width: 800px) {
      .calculator-container { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>DGS ROI Calculator</h1>
  <p class="subtitle">Quickly visualize potential returns from digital transformation investments.</p>

  <div class="calculator-container">
    <div class="card">
      <h2>Process ROI</h2>
      <label>Annual Time Saved (hrs)</label>
      <input id="processHours" type="number" value="1200" />

      <label>Hourly Rate ($)</label>
      <input id="hourlyRate" type="number" value="40" />

      <label>Implementation Cost ($)</label>
      <input id="implementationCost" type="number" value="10000" />

      <button id="calcProcess">Calculate ROI</button>
      <button id="resetProcess" class="secondary">Reset</button>

      <div class="result" id="processResult"></div>
      <canvas id="processChart"></canvas>
    </div>

    <div class="card">
      <h2>Investment ROI (NPV & IRR)</h2>
      <label>Initial Investment ($)</label>
      <input id="investment" type="number" value="50000" />

      <label>Annual Cash Flow ($)</label>
      <input id="cashFlow" type="number" value="15000" />

      <label>Years</label>
      <input id="years" type="number" value="5" />

      <label>Discount Rate (%)</label>
      <input id="discountRate" type="number" value="10" />

      <button id="calcNPV">Calculate NPV & IRR</button>
      <button id="resetNPV" class="secondary">Reset</button>

      <div class="result" id="npvResult"></div>
      <canvas id="npvChart"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const processBtn = document.getElementById('calcProcess');
    const resetProcessBtn = document.getElementById('resetProcess');
    const npvBtn = document.getElementById('calcNPV');
    const resetNPVBtn = document.getElementById('resetNPV');

    let processChart, npvChart;

    processBtn.addEventListener('click', calcProcessROI);
    resetProcessBtn.addEventListener('click', resetProcess);
    npvBtn.addEventListener('click', calcNPV);
    resetNPVBtn.addEventListener('click', resetNPV);

    function calcProcessROI() {
      const hours = parseFloat(document.getElementById('processHours').value);
      const rate = parseFloat(document.getElementById('hourlyRate').value);
      const cost = parseFloat(document.getElementById('implementationCost').value);
      const savings = hours * rate;
      const roi = ((savings - cost) / cost) * 100;

      document.getElementById('processResult').innerHTML = 
        `<div><strong>Annual Savings:</strong> <span class='result-value'>$${savings.toLocaleString()}</span></div>
         <div><strong>ROI:</strong> <span class='result-value'>${roi.toFixed(2)}%</span></div>`;

      const data = [cost, savings - cost];
      const ctx = document.getElementById('processChart').getContext('2d');
      if (processChart) processChart.destroy();
      processChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Cost', 'Net Gain'],
          datasets: [{
            data,
            backgroundColor: ['#d1d5db', 'var(--primary)'],
          }]
        },
        options: {
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }

    function calcNPV() {
      const invest = parseFloat(document.getElementById('investment').value);
      const cashFlow = parseFloat(document.getElementById('cashFlow').value);
      const years = parseInt(document.getElementById('years').value);
      const discountRate = parseFloat(document.getElementById('discountRate').value) / 100;

      let npv = -invest;
      let values = [-invest];
      for (let t = 1; t <= years; t++) {
        const discounted = cashFlow / Math.pow(1 + discountRate, t);
        npv += discounted;
        values.push(discounted);
      }

      const irr = computeIRR([-invest, ...Array(years).fill(cashFlow)]) * 100;
      document.getElementById('npvResult').innerHTML = 
        `<div><strong>NPV:</strong> <span class='result-value'>$${npv.toLocaleString(undefined, {maximumFractionDigits:2})}</span></div>
         <div><strong>IRR:</strong> <span class='result-value'>${irr.toFixed(2)}%</span></div>`;

      const ctx = document.getElementById('npvChart').getContext('2d');
      if (npvChart) npvChart.destroy();
      npvChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Investment', ...Array.from({length: years}, (_, i) => 'Year ' + (i+1))],
          datasets: [{
            label: 'Cash Flow',
            data: values,
            backgroundColor: 'var(--accent)'
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            y: {
              ticks: {
                callback: v => '$' + v.toLocaleString()
              }
            }
          }
        }
      });
    }

    function computeIRR(values) {
      let minRate = -0.99, maxRate = 1, guess = 0.1;
      const npv = r => values.reduce((acc, val, i) => acc + val / Math.pow(1 + r, i), 0);
      for (let i = 0; i < 100; i++) {
        const npvGuess = npv(guess);
        if (Math.abs(npvGuess) < 1e-6) break;
        guess = npvGuess > 0 ? (guess + maxRate) / 2 : (guess + minRate) / 2;
      }
      return guess;
    }

    function resetProcess() {
      document.getElementById('processHours').value = 1200;
      document.getElementById('hourlyRate').value = 40;
      document.getElementById('implementationCost').value = 10000;
      document.getElementById('processResult').innerHTML = '';
      if (processChart) processChart.destroy();
    }

    function resetNPV() {
      document.getElementById('investment').value = 50000;
      document.getElementById('cashFlow').value = 15000;
      document.getElementById('years').value = 5;
      document.getElementById('discountRate').value = 10;
      document.getElementById('npvResult').innerHTML = '';
      if (npvChart) npvChart.destroy();
    }

    // Auto-init example on load
    calcProcessROI();
  </script>
</body>
</html>
